[![Python 3.7](https://img.shields.io/badge/python-3.7-blue.svg)](https://www.python.org/downloads/release/python-370/)

# Code and Data to reproduce "ShapleyIQ: Influence Quantification by Shapley Values for Performance Debugging of Microservices" (ASPLOS' 23)

## TL;DR
```bash
git clone https://github.com/lonyle/ShapleyIQ
cd ShapleyIQ
```
(the above step may take 1-10 minutes)

- Using Python 3.7
- Download the prepared dataset **data.zip** from [link](https://1drv.ms/u/s!AuhX-fJM-sJvhHJOWRy9IOK1sDbv?e=zqutJo). Unzip it into the folder **rca4tracing/fault_injection/data**.
```bash
pip install -r requirements.txt
```
(the above step may take 1-10 minutes)

```bash
bash run/run.sh
```
(the above step should take less than 1 hour)

## 1. Descriptions of folders

(1) the code of the ShapleyIQ algorithm and other baseline algorithms; (2) the input data generated by the TrainTicket system (3) code to run the algorithms with the input data. (4) code to run the TrainTicket system, inject faults, and generate the input data for root cause analysis. 

<!-- ### technical_report.pdf
    It includes the proofs of all Theorems, the details on how to generalize to performance schema data and QPS data, etc. -->
### (1) rca4tracing 
* This folder contains the ShapleyIQ algorithm (**rca4tracing/rca/shapley_value_rca.py**), and the baseline algorithms (in folder **rca4tracing/rca/baselines/**)
* After running the algorithm according to **run/README.md**, the experiment results will be in the folder **rca4tracing/experiment/output_data/experiment_jaeger**

### (2) prepare_data
* **prepare_data/README.md** provides instructions to prepare the input data.


### (3) run 
The folder **run** contains scripts to run the experiments and a detailed **run/README.md** file.

### (4) introduction_example
To reproduce the example of Figure 1 in the Introduction section of the paper.

<!-- * We provide the code for all the baseline algorithms, the collected data from TrainTicket, and the collected MySQL performance schema data
    - The TrainTicket data is in fault_injection/data.zip
    - The performance schema data is in datasources/perf_schema/datasets/ 
    - The experiment results on TrainTicket are in experiment/output_data/experiment_jaeger.zip -->
<!-- ### Code_and_Data.zip
We provide the .zip file for the Code_and_Data folder (including the data), you can visit the following anonymized link to download it: **https://1drv.ms/u/s!AuhX-fJM-sJvgza0-Wy5i7cLBRFa?e=5OhBjw**

* We provide the .pyc file of ShapleyRCA in **rca4tracing/rca/shapley_value_rca.pyc** for reproduction of our experiment results. The Python source code of ShapleyRCA will be released once it is approved by our legal department. -->

## 2. Workflow to run the experiments
<!-- 1. Unzip the Code_and_Data.zip

In order to save space of this repo, we compress the data files.
Please unzip the Code_and_Data.zip that you have downloaded from  **https://1drv.ms/u/s!AuhX-fJM-sJvgza0-Wy5i7cLBRFa?e=5OhBjw** before you run the experiments. -->

### 1. Install the necessary python packages
install Python 3.7
```bash
pip install -r requirements.txt
```

### 2. Prepare the TrainTicket dataset. The details are in **prepare_data/README.md**
There are two ways to prepare the dataset. The first way is to download the prepared dataset in [link](https://1drv.ms/u/s!AuhX-fJM-sJvhHJOWRy9IOK1sDbv?e=zqutJo). The second is to run a TrainTicket microservice system and generate the dataset by injecting faults. The details are in **prepare_data/README.md**.

### 3. Run the experiments, including 
1) experiments with a single root cause 2) experiments with multiple root causes 3) experiments for global root cause analysis, etc. 


To run all the experiments, (the detailed explanations are in **run/README.md**) just type the following one-line command:
```bash
bash run/run.sh
```

If you only want to run the experiments for a single root cause, you can run the following:
```bash
python rca4tracing/rca/experiment/experiment_jaeger.py 
```



